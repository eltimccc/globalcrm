{% extends 'base.html' %}

{% block content %}
<div class="container">
  <div class="card mt-5">
    <div class="card-header">
      <h2>{{ task.title }}</h2>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-3"><strong>Создано:</strong></div>
        <div class="col-md-9">{{ task.created_at|date:"d.m.Y H:i" }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Задачу предоставил:</strong></div>
        <div class="col-md-9">{{ task.created_by }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Работнику:</strong></div>
        <div class="col-md-9">{{ task.worker }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Описание задачи:</strong></div>
        <div class="col-md-9">{{ task.description }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Крайний срок выполнения:</strong></div>
        <div class="col-md-9">{{ task.deadline|date:"d.m.Y H:i" }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Статус:</strong></div>
        <div class="col-md-9">{{ task.completed }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>Дата завершения:</strong></div>
        <div class="col-md-9">{{ task.completed_at|date:"d.m.Y H:i" }}</div>
      </div>
      <div class="row">
        <div class="col-md-3"><strong>История выполнения:</strong></div>
        <div class="col-md-9">
          {% if task.subtasks.all %}
            <ul>
              {% for subtask in task.subtasks.all %}
                <li><a href="{% url 'tasks:task_detail' subtask.pk %}">{{ subtask.title }}</a></li>
              {% endfor %}
            </ul>
          {% else %}
            <p>У этой задачи нет истории.</p>
          {% endif %}
        </div>
      </div>
      {% for subtask in task.subtasks.all %}
      <div class="row">
        <div class="col-md-3"><strong>{{ subtask.title }}:</strong></div>
        <div class="col-md-9">
          <!-- Вывод информации о подзадаче -->
          <div><strong>Создано:</strong> {{ subtask.created_at|date:"d.m.Y H:i" }}</div>
          <div><strong>Задачу предоставил:</strong> {{ subtask.created_by }}</div>
          <div><strong>Работнику:</strong> {{ subtask.worker }}</div>
          <div><strong>Описание задачи:</strong> {{ subtask.description }}</div>
          <div><strong>Крайний срок выполнения:</strong> {{ subtask.deadline|date:"d.m.Y H:i" }}</div>
          <div><strong>Статус:</strong> {{ subtask.completed }}</div>
          <div><strong>Дата завершения:</strong> {{ subtask.completed_at|date:"d.m.Y H:i" }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="card-footer d-flex justify-content-between">
      <form method="post" action="{% url 'tasks:task_detail' task.pk %}">
        {% csrf_token %}
        {% if task.completed %}
          <button type="submit" class="btn btn-danger">Отменить выполнение</button>
        {% else %}
          <button type="submit" class="btn btn-success">Завершить задачу</button>
        {% endif %}
      </form>
      <a href="{% url 'tasks:update_task' task.pk %}" class="btn btn-primary">Редактировать</a>
      {% if task.created_by == user %}
      <form method="GET" action="{% url 'tasks:delete_task' task.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger ml-2">Удалить</button>
      </form>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
